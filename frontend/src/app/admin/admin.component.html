<div class="admin-container">
  <!-- HEADER -->
  <header class="admin-header">
    <div class="header-content">
      <h1>üîß Panel de Administraci√≥n</h1>
      <button class="btn-logout" (click)="cerrarSesion()">Cerrar Sesi√≥n</button>
    </div>
  </header>

  <!-- NAVEGACI√ìN POR PESTA√ëAS -->
  <nav class="admin-tabs">
    <button 
      class="tab-button" 
      [class.active]="vistaActual() === 'usuarios'"
      (click)="cambiarVista('usuarios')">
      üë• Usuarios
    </button>
    <button 
      class="tab-button" 
      [class.active]="vistaActual() === 'barcos'"
      (click)="cambiarVista('barcos')">
      üö¢ Barcos
    </button>
    <button 
      class="tab-button" 
      [class.active]="vistaActual() === 'modelos'"
      (click)="cambiarVista('modelos')">
      üé® Modelos
    </button>
    <button 
      class="tab-button" 
      [class.active]="vistaActual() === 'tableros'"
      (click)="cambiarVista('tableros')">
      üó∫Ô∏è Tableros
    </button>
  </nav>

  <!-- MENSAJES -->
  @if (mensaje()) {
    <div class="mensaje-info">
      {{ mensaje() }}
      <button (click)="mensaje.set('')">‚úï</button>
    </div>
  }

  <!-- CONTENIDO -->
  <main class="admin-content">
    @if (cargando()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando...</p>
      </div>
    }

    <!-- ========== VISTA USUARIOS ========== -->
    @if (vistaActual() === 'usuarios' && !cargando()) {
      <div class="seccion-usuarios">
        <div class="seccion-header">
          <h2>Gesti√≥n de Usuarios</h2>
          <p class="total">Total: {{ usuarios().length }} usuarios</p>
        </div>

        <div class="tabla-container">
          <table class="tabla-admin">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Estado</th>
                <th>Barco Seleccionado</th>
                <th>√öltimo Acceso</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (user of usuarios(); track user.id) {
                <tr [class.inactivo]="!user.activo">
                  <td>{{ user.id }}</td>
                  <td>
                    <strong>{{ user.username }}</strong>
                  </td>
                  <td>{{ user.email }}</td>
                  <td>
                    <span class="badge" [class.badge-admin]="user.roles.includes('ADMIN')">
                      {{ getRolesDisplay(user.roles) }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [class.badge-activo]="user.activo" [class.badge-inactivo]="!user.activo">
                      {{ user.activo ? 'Activo' : 'Inactivo' }}
                    </span>
                  </td>
                  <td>
                    @if (user.barcoSeleccionadoNombre) {
                      {{ user.barcoSeleccionadoNombre }}
                    } @else {
                      <span class="text-muted">Sin barco</span>
                    }
                  </td>
                  <td>{{ formatDate(user.ultimoAcceso) }}</td>
                  <td>
                    <div class="acciones">
                      <button 
                        class="btn-accion btn-toggle" 
                        (click)="toggleUsuarioStatus(user.id)"
                        [title]="user.activo ? 'Desactivar' : 'Activar'">
                        {{ user.activo ? 'üî¥' : 'üü¢' }}
                      </button>
                      <button 
                        class="btn-accion btn-eliminar" 
                        (click)="eliminarUsuario(user.id, user.username)"
                        title="Eliminar">
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="8" class="texto-vacio">No hay usuarios registrados</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- ========== VISTA BARCOS ========== -->
    @if (vistaActual() === 'barcos' && !cargando()) {
      <div class="seccion-barcos">
        <div class="seccion-header">
          <h2>Gesti√≥n de Barcos</h2>
          <p class="total">Total: {{ barcos().length }} barcos</p>
        </div>

        @if (barcoEditando()) {
          <div class="modal-overlay" (click)="cancelarEdicionBarco()">
            <div class="modal-content" (click)="$event.stopPropagation()">
              <h3>Editar Barco #{{ barcoEditando()!.id }}</h3>
              <form (ngSubmit)="guardarBarco()">
                <div class="form-group">
                  <label>Velocidad X (vx)</label>
                  <input 
                    type="number" 
                    [(ngModel)]="barcoEditando()!.velocidadX"
                    name="velocidadX"
                    step="0.1"
                    required>
                </div>
                <div class="form-group">
                  <label>Velocidad Y (vy)</label>
                  <input 
                    type="number" 
                    [(ngModel)]="barcoEditando()!.velocidadY"
                    name="velocidadY"
                    step="0.1"
                    required>
                </div>
                <div class="modal-acciones">
                  <button type="submit" class="btn-guardar">Guardar</button>
                  <button type="button" class="btn-cancelar" (click)="cancelarEdicionBarco()">Cancelar</button>
                </div>
              </form>
            </div>
          </div>
        }

        <div class="tabla-container">
          <table class="tabla-admin">
            <thead>
              <tr>
                <th>ID</th>
                <th>Modelo</th>
                <th>Velocidad X</th>
                <th>Velocidad Y</th>
                <th>Jugador</th>
                <th>Posici√≥n</th>
                <th>Tablero</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (barco of barcos(); track barco.id) {
                <tr>
                  <td>{{ barco.id }}</td>
                  <td>
                    @if (barco.modelo) {
                      <span class="badge-color" [style.background-color]="barco.modelo.color">
                        {{ barco.modelo.nombre }}
                      </span>
                    } @else {
                      <span class="text-muted">Sin modelo</span>
                    }
                  </td>
                  <td>{{ barco.velocidadX }}</td>
                  <td>{{ barco.velocidadY }}</td>
                  <td>
                    @if (barco.jugadorNombre) {
                      {{ barco.jugadorNombre }}
                    } @else {
                      <span class="text-muted">Sin jugador</span>
                    }
                  </td>
                  <td>
                    @if (barco.posicion) {
                      ({{ barco.posicion.x }}, {{ barco.posicion.y }})
                    } @else {
                      <span class="text-muted">Sin posici√≥n</span>
                    }
                  </td>
                  <td>
                    @if (barco.tableroId) {
                      Tablero #{{ barco.tableroId }}
                    } @else {
                      <span class="text-muted">Sin tablero</span>
                    }
                  </td>
                  <td>
                    <div class="acciones">
                      <button 
                        class="btn-accion btn-editar" 
                        (click)="editarBarco(barco)"
                        title="Editar">
                        ‚úèÔ∏è
                      </button>
                      <button 
                        class="btn-accion btn-eliminar" 
                        (click)="eliminarBarco(barco.id, barco.modelo?.nombre)"
                        title="Eliminar">
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="8" class="texto-vacio">No hay barcos registrados</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- ========== VISTA MODELOS ========== -->
    @if (vistaActual() === 'modelos' && !cargando()) {
      <div class="seccion-modelos">
        <div class="seccion-header">
          <h2>Gesti√≥n de Modelos</h2>
          <p class="total">Total: {{ modelos().length }} modelos</p>
        </div>

        <!-- Formulario nuevo modelo -->
        <div class="form-nuevo">
          <h3>Crear Nuevo Modelo</h3>
          <form (ngSubmit)="crearModelo()" class="form-inline">
            <input 
              type="text" 
              [(ngModel)]="nuevoModelo.nombre"
              name="nombre"
              placeholder="Nombre del modelo"
              required>
            <input 
              type="color" 
              [(ngModel)]="nuevoModelo.color"
              name="color"
              title="Color">
            <button type="submit" class="btn-crear">Crear Modelo</button>
          </form>
        </div>

        @if (modeloEditando()) {
          <div class="modal-overlay" (click)="cancelarEdicionModelo()">
            <div class="modal-content" (click)="$event.stopPropagation()">
              <h3>Editar Modelo #{{ modeloEditando()!.id }}</h3>
              <form (ngSubmit)="guardarModelo()">
                <div class="form-group">
                  <label>Nombre</label>
                  <input 
                    type="text" 
                    [(ngModel)]="modeloEditando()!.nombre"
                    name="nombre"
                    required>
                </div>
                <div class="form-group">
                  <label>Color</label>
                  <input 
                    type="color" 
                    [(ngModel)]="modeloEditando()!.color"
                    name="color"
                    required>
                </div>
                <div class="modal-acciones">
                  <button type="submit" class="btn-guardar">Guardar</button>
                  <button type="button" class="btn-cancelar" (click)="cancelarEdicionModelo()">Cancelar</button>
                </div>
              </form>
            </div>
          </div>
        }

        <div class="tabla-container">
          <table class="tabla-admin">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Color</th>
                <th>Vista Previa</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (modelo of modelos(); track modelo.id) {
                <tr>
                  <td>{{ modelo.id }}</td>
                  <td><strong>{{ modelo.nombre }}</strong></td>
                  <td>{{ modelo.color }}</td>
                  <td>
                    <div class="preview-color" [style.background-color]="modelo.color"></div>
                  </td>
                  <td>
                    <div class="acciones">
                      <button 
                        class="btn-accion btn-editar" 
                        (click)="editarModelo(modelo)"
                        title="Editar">
                        ‚úèÔ∏è
                      </button>
                      <button 
                        class="btn-accion btn-eliminar" 
                        (click)="eliminarModelo(modelo.id, modelo.nombre)"
                        title="Eliminar">
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="5" class="texto-vacio">No hay modelos registrados</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }

    <!-- ========== VISTA TABLEROS ========== -->
    @if (vistaActual() === 'tableros' && !cargando()) {
      <div class="seccion-tableros">
        <div class="seccion-header">
          <h2>Gesti√≥n de Tableros</h2>
          <p class="total">Total: {{ tableros().length }} tableros</p>
        </div>

        <div class="tabla-container">
          <table class="tabla-admin">
            <thead>
              <tr>
                <th>ID</th>
                <th>Celdas</th>
                <th>Informaci√≥n</th>
              </tr>
            </thead>
            <tbody>
              @for (tablero of tableros(); track tablero.id) {
                <tr>
                  <td>{{ tablero.id }}</td>
                  <td>{{ tablero.celdas?.length || 0 }} celdas</td>
                  <td>
                    <span class="text-muted">Tablero de juego</span>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="3" class="texto-vacio">No hay tableros registrados</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  </main>
</div>
